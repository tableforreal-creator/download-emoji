<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width,initial-scale=1">
        <title>Discord Emoji & Sticker Downloader - DiscordKit</title>
        <style>
            :root {
                --bg-color: #36393f;
                --bg-secondary: #2f3136;
                --text-color: #dcddde;
                --text-header: #ffffff;
                --accent-color: #5865f2;
                --accent-hover: #4752c4;
                --danger-color: #ed4245;
                --success-color: #3ba55c;
                --border-color: #202225;
                --input-bg: #202225
            }

            body {
                width: 450px;
                min-height: 500px;
                margin: 0;
                padding: 0;
                background-color: var(--bg-color);
                color: var(--text-color);
                font-family: 'Segoe UI',Roboto,sans-serif;
                font-size: 14px;
                display: flex;
                flex-direction: column
            }

            ::-webkit-scrollbar {
                width: 8px;
                height: 8px
            }

            ::-webkit-scrollbar-track {
                background-color: #2e3338
            }

            ::-webkit-scrollbar-thumb {
                background-color: #202225;
                border-radius: 4px
            }

            .promo-banner {
                background: linear-gradient(90deg,#ff9a00,#ff5e00);
                color: #fff;
                padding: 8px 0;
                font-weight: 700;
                font-size: 13px;
                cursor: pointer;
                box-shadow: 0 2px 4px rgba(0,0,0,.2);
                position: relative;
                z-index: 100;
                display: none;
                overflow: hidden;
                white-space: nowrap
            }

            .promo-banner-content {
                display: inline-flex;
                align-items: center;
                gap: 8px;
                padding-left: 100%;
                animation: marquee 15s linear infinite
            }

            @keyframes marquee {
                0% {
                    transform: translateX(0)
                }

                100% {
                    transform: translateX(-100%)
                }
            }

            .container {
                padding: 20px;
                display: flex;
                flex-direction: column;
                gap: 16px;
                flex: 1
            }

            .header {
                display: flex;
                align-items: center;
                justify-content: center;
                gap: 12px;
                margin-bottom: 10px
            }

            .header img {
                width: 40px;
                height: 40px;
                border-radius: 8px
            }

            .header h1 {
                font-size: 18px;
                color: var(--text-header);
                margin: 0;
                font-weight: 700
            }

            .premium-badge {
                background: linear-gradient(135deg,gold,orange);
                color: #2f3136;
                padding: 2px 6px;
                border-radius: 4px;
                font-size: 10px;
                font-weight: 900;
                box-shadow: 0 0 10px rgba(255,215,0,.5);
                border: 1px solid #fff;
                margin-left: -4px;
                animation: shine 3s infinite;
                display: none
            }

            @keyframes shine {
                0% {
                    filter: brightness(1)
                }

                50% {
                    filter: brightness(1.2);
                    box-shadow: 0 0 15px rgba(255,215,0,.7)
                }

                100% {
                    filter: brightness(1)
                }
            }

            .limit-info {
                font-size: 13px;
                text-align: center;
                margin-top: -10px;
                margin-bottom: 10px;
                padding: 10px;
                border-radius: 6px;
                font-weight: 700;
                font-family: sans-serif;
                transition: all .2s ease;
                cursor: default
            }

            .limit-info-free {
                background: rgba(255,165,0,.15);
                border: 1px solid rgba(255,165,0,.3);
                color: gold;
                cursor: pointer
            }

            .limit-info-free:hover {
                background: rgba(255,165,0,.25);
                transform: translateY(-1px)
            }

            .limit-info-free span.upgrade-link {
                text-decoration: underline;
                color: #fff;
                margin-left: 8px
            }

            .limit-info-pro {
                background: linear-gradient(90deg,rgba(88,101,242,.2),rgba(88,101,242,.4));
                border: 1px solid rgba(88,101,242,.5);
                color: #fff;
                text-shadow: 0 0 10px rgba(88,101,242,.5);
                display: flex;
                align-items: center;
                justify-content: center;
                gap: 8px
            }

            .status-bar {
                background-color: var(--bg-secondary);
                padding: 10px;
                border-radius: 4px;
                border: 1px solid var(--border-color);
                display: flex;
                align-items: center;
                gap: 8px;
                font-size: 13px
            }

            .status-icon {
                width: 10px;
                height: 10px;
                border-radius: 50%;
                background-color: #747f8d
            }

            .status-connected .status-icon {
                background-color: var(--success-color);
                box-shadow: 0 0 8px var(--success-color)
            }

            .status-error .status-icon {
                background-color: var(--danger-color)
            }

            .gallery-controls {
                display: flex;
                justify-content: space-between;
                align-items: center;
                margin-bottom: 8px
            }

            .gallery-actions {
                display: flex;
                gap: 8px
            }

            .btn-xs {
                padding: 4px 8px;
                font-size: 11px;
                background-color: var(--bg-secondary);
                border: 1px solid var(--border-color);
                color: var(--text-color);
                border-radius: 3px;
                cursor: pointer;
                transition: all .2s
            }

            .btn-xs:hover {
                background-color: var(--accent-color);
                color: #fff;
                border-color: var(--accent-color)
            }

            .grid-container {
                display: grid;
                grid-template-columns: repeat(auto-fill,minmax(60px,1fr));
                gap: 8px;
                max-height: 220px;
                overflow-y: auto;
                padding: 8px;
                background-color: var(--bg-secondary);
                border: 1px solid var(--border-color);
                border-radius: 4px
            }

            .grid-item {
                position: relative;
                background-color: var(--bg-color);
                border: 2px solid transparent;
                border-radius: 6px;
                aspect-ratio: 1;
                display: flex;
                align-items: center;
                justify-content: center;
                cursor: pointer;
                transition: all .1s;
                overflow: hidden
            }

            .grid-item:hover {
                transform: translateY(-2px);
                box-shadow: 0 4px 8px rgba(0,0,0,.2)
            }

            .grid-item.selected {
                border-color: var(--accent-color);
                background-color: rgba(88,101,242,.1)
            }

            .grid-item.selected::after {
                content: 'âœ“';
                position: absolute;
                top: 2px;
                right: 2px;
                background-color: var(--accent-color);
                color: #fff;
                font-size: 10px;
                width: 14px;
                height: 14px;
                border-radius: 50%;
                display: flex;
                align-items: center;
                justify-content: center;
                font-weight: 700
            }

            .grid-item img {
                width: 80%;
                height: 80%;
                object-fit: contain
            }

            .grid-item .item-name {
                display: none
            }

            .form-group {
                display: flex;
                flex-direction: column;
                gap: 8px
            }

            .form-label {
                color: #b9bbbe;
                font-size: 12px;
                text-transform: uppercase;
                font-weight: 700
            }

            .custom-select-wrapper {
                position: relative;
                user-select: none
            }

            .custom-select {
                position: relative;
                display: flex;
                flex-direction: column
            }

            .custom-select-trigger {
                position: relative;
                display: flex;
                align-items: center;
                justify-content: space-between;
                padding: 10px;
                background: var(--input-bg);
                color: var(--text-color);
                border-radius: 4px;
                cursor: pointer;
                border: 1px solid var(--border-color);
                transition: border-color .2s
            }

            .custom-select-trigger:hover {
                border-color: #040405
            }

            .custom-options {
                position: absolute;
                display: block;
                top: 100%;
                left: 0;
                right: 0;
                border: 1px solid var(--border-color);
                border-top: 0;
                background: var(--bg-secondary);
                transition: all .2s;
                opacity: 0;
                visibility: hidden;
                pointer-events: none;
                z-index: 50;
                max-height: 200px;
                overflow-y: auto;
                border-radius: 0 0 4px 4px;
                box-shadow: 0 4px 8px rgba(0,0,0,.2)
            }

            .custom-select.open .custom-options {
                opacity: 1;
                visibility: visible;
                pointer-events: all
            }

            .custom-option {
                position: relative;
                display: flex;
                align-items: center;
                padding: 10px;
                font-size: 14px;
                color: var(--text-color);
                cursor: pointer;
                transition: all .2s;
                gap: 8px
            }

            .custom-option:hover {
                background-color: var(--accent-color);
                color: #fff
            }

            .custom-option.selected {
                background-color: rgba(88,101,242,.3)
            }

            .custom-option img {
                width: 24px;
                height: 24px;
                border-radius: 4px;
                object-fit: contain
            }

            .arrow {
                width: 0;
                height: 0;
                border-left: 5px solid transparent;
                border-right: 5px solid transparent;
                border-top: 5px solid #b9bbbe;
                transition: transform .2s
            }

            .custom-select.open .arrow {
                transform: rotate(180deg)
            }

            .btn {
                display: flex;
                align-items: center;
                justify-content: center;
                padding: 10px 16px;
                border: none;
                border-radius: 4px;
                font-size: 14px;
                font-weight: 500;
                cursor: pointer;
                transition: background-color .2s;
                color: #fff;
                text-decoration: none;
                gap: 8px
            }

            .btn-primary {
                background-color: var(--accent-color)
            }

            .btn-primary:hover {
                background-color: var(--accent-hover)
            }

            .btn-success {
                background-color: var(--success-color)
            }

            .btn-full {
                width: 100%
            }

            .message {
                padding: 10px;
                border-radius: 4px;
                font-size: 13px;
                text-align: center;
                display: none
            }

            .message-success {
                background-color: rgba(59,165,92,.1);
                border: 1px solid var(--success-color);
                color: var(--success-color)
            }

            .message-error {
                background-color: rgba(237,66,69,.1);
                border: 1px solid var(--danger-color);
                color: var(--danger-color)
            }

            .redirect-page {
                display: flex;
                flex-direction: column;
                align-items: center;
                justify-content: center;
                height: 100%;
                padding: 40px;
                text-align: center;
                flex: 1
            }

            .redirect-icon {
                width: 64px;
                height: 64px;
                margin-bottom: 20px;
                fill: var(--accent-color)
            }

            .redirect-page h2 {
                margin: 0 0 10px 0;
                color: var(--text-header)
            }

            .redirect-page p {
                color: #b9bbbe;
                margin-bottom: 20px
            }

            .modal {
                display: none;
                position: fixed;
                z-index: 1000;
                left: 0;
                top: 0;
                width: 100%;
                height: 100%;
                background-color: rgba(0,0,0,.8);
                align-items: center;
                justify-content: center
            }

            .modal-content {
                background-color: var(--bg-color);
                padding: 24px;
                border-radius: 8px;
                width: 85%;
                max-width: 320px;
                text-align: center;
                position: relative;
                box-shadow: 0 8px 24px rgba(0,0,0,.5);
                display: flex;
                flex-direction: column;
                gap: 16px
            }

            .close-modal {
                position: absolute;
                top: 12px;
                right: 12px;
                width: 24px;
                height: 24px;
                cursor: pointer;
                fill: #b9bbbe;
                transition: fill .2s
            }

            .close-modal:hover {
                fill: white
            }

            .modal h3 {
                margin: 0;
                color: var(--text-header)
            }

            .modal p {
                margin: 0;
                color: #b9bbbe;
                line-height: 1.5
            }

            .loading-overlay {
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0,0,0,.7);
                display: none;
                align-items: center;
                justify-content: center;
                z-index: 2000;
                flex-direction: column;
                gap: 10px
            }

            .spinner {
                width: 40px;
                height: 40px;
                border: 4px solid rgba(255,255,255,.1);
                border-left-color: var(--accent-color);
                border-radius: 50%;
                animation: spin 1s linear infinite
            }

            @keyframes spin {
                to {
                    transform: rotate(360deg)
                }
            }

            .icon {
                width: 16px;
                height: 16px;
                fill: currentColor
            }
        </style>
    </head>
    <body>
        <div id="promo-banner" class="promo-banner">
            <div class="promo-banner-content">
                <span>ðŸŽ‰</span>
                <span>50% OFF Limited Time Offer! Upgrade Now!</span>
                <span>ðŸŽ‰</span>
            </div>
        </div>
        <div id="discord-redirect" class="redirect-page" style="display:none">
            <svg class="redirect-icon" viewBox="0 0 24 24">
                <path d="M19.27 5.33C17.94 4.71 16.5 4.26 15 4a.09.09 0 0 0-.07.03c-.18.33-.39.76-.53 1.09a16.09 16.09 0 0 0-4.8 0c-.14-.34-.35-.76-.54-1.09c-.01-.02-.04-.03-.07-.03c-1.5.26-2.93.71-4.27 1.33c-.01 0-.02.01-.03.02c-2.72 4.07-3.47 8.03-3.1 11.95c0 .02.01.04.03.05c1.8 1.32 3.53 2.12 5.2 2.65c.03.01.06 0 .07-.02c.4-.55.76-1.13 1.07-1.74c.02-.04 0-.08-.04-.09c-.57-.22-1.11-.48-1.64-.78c-.04-.02-.04-.08.01-.11c.11-.08.22-.17.33-.25c.02-.02.05-.02.07-.01c3.44 1.57 7.15 1.57 10.55 0c.02-.01.05-.01.07.01c.11.09.22.17.33.26c.04.03.04.09-.01.11c-.53.31-1.1.56-1.65.78c-.04.01-.05.06-.04.09c.31.61.66 1.19 1.07 1.74c.02.01.05.02.09.02c1.67-.53 3.37-1.33 5.34-2.65c.02-.01.03-.03.03-.05c.44-4.53-.73-8.46-3.1-11.95c-.01-.01-.02-.02-.04-.02zM8.52 14.91c-1.03 0-1.89-.95-1.89-2.12s.84-2.12 1.89-2.12c1.06 0 1.9.96 1.89 2.12c0 1.17-.84 2.12-1.89 2.12zm6.97 0c-1.03 0-1.89-.95-1.89-2.12s.84-2.12 1.89-2.12c1.06 0 1.9.96 1.89 2.12c0 1.17-.83 2.12-1.89 2.12z"/>
            </svg>
            <h2>Discord Emoji Downloader</h2>
            <p>Please open Discord web version to use this extension</p>
            <button id="open-discord" class="btn btn-primary">Open Discord</button>
        </div>
        <div id="main-content" class="container" style="display:none">
            <div class="header">
                <img src="icons/logo48.png" alt="Logo">
                <h1>Discord Emoji & Sticker Downloader</h1>
                <span id="premium-badge" class="premium-badge">PRO</span>
            </div>
            <div class="status-bar" id="status-bar">
                <div class="status-icon"></div>
                <span id="status-text">Connecting...</span>
            </div>
            <div id="limit-info" class="limit-info limit-info-free" style="display:none">
                ðŸ”’ Free Limit: 10 items/batch <span class="upgrade-link">Unlock Unlimited âš¡</span>
            </div>
            <div class="form-group">
                <label class="form-label">Select Server</label>
                <div class="custom-select-wrapper">
                    <div class="custom-select" id="server-select">
                        <div class="custom-select-trigger">
                            <span>Select Server</span>
                            <div class="arrow"></div>
                        </div>
                        <div class="custom-options"></div>
                    </div>
                </div>
            </div>
            <div class="form-group" id="emoji-group" style="display:none">
                <div class="gallery-controls">
                    <label class="form-label">
                        Emojis (<span id="emoji-count">0/0</span>
                        )
                    </label>
                    <div class="gallery-actions">
                        <button class="btn-xs" id="emoji-select-all">Select All</button>
                        <button class="btn-xs" id="emoji-select-none">None</button>
                    </div>
                </div>
                <div class="grid-container" id="emoji-grid"></div>
            </div>
            <div class="form-group" id="sticker-group" style="display:none">
                <div class="gallery-controls">
                    <label class="form-label">
                        Stickers (<span id="sticker-count">0/0</span>
                        )
                    </label>
                    <div class="gallery-actions">
                        <button class="btn-xs" id="sticker-select-all">Select All</button>
                        <button class="btn-xs" id="sticker-select-none">None</button>
                    </div>
                </div>
                <div class="grid-container" id="sticker-grid"></div>
            </div>
            <div id="success-message" class="message message-success">Successfully downloaded!</div>
            <div id="error-message" class="message message-error">An error occurred.</div>
            <div style="margin-top:auto">
                <button id="download-btn" class="btn btn-primary btn-full" style="display:none">
                    <svg class="icon" viewBox="0 0 24 24">
                        <path d="M19 9h-4V3H9v6H5l7 7 7-7zM5 18v2h14v-2H5z"/>
                    </svg>
                    <span id="download-btn-text">Download All</span>
                </button>
            </div>
        </div>
        <div id="upgrade-modal" class="modal">
            <div class="modal-content">
                <svg class="close-modal" viewBox="0 0 24 24">
                    <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
                </svg>
                <h3 style="color:var(--accent-color)">Free Limit Reached</h3>
                <p>Free users can only download up to 10 items at a time.</p>
                <p style="font-weight:700;color:#fff">
                    You selected <span id="modal-count">0</span>
                    items.
                </p>
                <button id="modal-upgrade-btn" class="btn btn-primary btn-full">
                    <svg class="icon" viewBox="0 0 24 24">
                        <path d="M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"/>
                    </svg>
                    Upgrade to Pro
                </button>
            </div>
        </div>
        <div id="loading-overlay" class="loading-overlay">
            <div class="spinner"></div>
            <div style="color:#fff;font-weight:700">Processing...</div>
        </div>
        <script src="libs/jszip.min.js"></script>
        <script src="libs/ExtPay.js"></script>
        <script src="popup.js"></script>
    </body>
</html>
